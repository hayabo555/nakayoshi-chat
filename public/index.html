<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»²è‰¯ã—CHAT</title>
    <link rel="stylesheet" href="style.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>

    <div id="page-login" class="page active">
        <header>ä»²è‰¯ã—CHAT ğŸŒ¸</header>
        <div class="content" style="text-align: center; padding-top: 50px;">
            <input type="text" id="username" placeholder="åå‰ã‚’å…¥åŠ›">
            <button onclick="login()" class="btn-main">ã¯ã˜ã‚ã‚‹</button>
        </div>
    </div>

    <div id="page-home" class="page">
        <header>ãƒ›ãƒ¼ãƒ </header>
        <div class="content">
            <div class="user-info">ğŸ‘¤ ã‚ãªãŸï¼š <span id="my-name-display"></span></div>
            <p style="color: #999; text-align: center; margin-top: 20px;">ãƒ•ãƒ¬ãƒ³ãƒ‰ã¯ã¾ã ã„ã¾ã›ã‚“</p>
        </div>
        <footer>
            <button onclick="showPage('home')">ğŸ <br>ãƒ›ãƒ¼ãƒ </button>
            <button onclick="showPage('rooms')">ğŸ’¬<br>ãŠã·ã¡ã‚ƒ</button>
            <button onclick="openYoutube()">ğŸ“º<br>YouTube</button>
        </footer>
    </div>

    <div id="page-rooms" class="page">
        <header>ã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆ</header>
        <div class="content">
            <div class="room-join">
                <input type="text" id="target-room" placeholder="éƒ¨å±‹åã‚’å…¥åŠ›">
                <button onclick="joinRoom()">å…¥å®¤</button>
            </div>
            <div onclick="joinRoom('é›‘è«‡éƒ¨å±‹')" class="room-card">ğŸŒ¸ é›‘è«‡éƒ¨å±‹</div>
            <div onclick="joinRoom('ã‚²ãƒ¼ãƒ éƒ¨å±‹')" class="room-card">ğŸ® ã‚²ãƒ¼ãƒ éƒ¨å±‹</div>
        </div>
        <footer>
            <button onclick="showPage('home')">ğŸ <br>ãƒ›ãƒ¼ãƒ </button>
            <button onclick="showPage('rooms')">ğŸ’¬<br>ãŠã·ã¡ã‚ƒ</button>
            <button onclick="openYoutube()">ğŸ“º<br>YouTube</button>
        </footer>
    </div>

    <div id="page-chat" class="page">
        <header>
            <button onclick="showPage('rooms')" style="float: left; color: white; background: none; border: none; font-size: 20px;">â—€</button>
            <span id="room-title">éƒ¨å±‹å</span>
        </header>
        <div id="messages"></div>
        <div class="input-area">
            <input type="text" id="msg-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸...">
            <button onclick="sendMsg()" style="color: #007aff; font-weight: bold; border: none; background: none;">é€ä¿¡</button>
        </div>
    </div>

    <script>
        const socket = io(); // ä¸€æœ¬åŒ–ã—ã¦ã„ã‚‹ã®ã§URLæŒ‡å®šä¸è¦
        let myName = "";
        let currentRoom = "";

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
        }

        function login() {
            myName = document.getElementById('username').value;
            if(!myName) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ã­");
            document.getElementById('my-name-display').innerText = myName;
            showPage('home');
        }

        function openYoutube() {
            window.location.href = "https://choco-tube-nana-01.onrender.com";
        }

        function joinRoom(name) {
            currentRoom = name || document.getElementById('target-room').value;
            if(!currentRoom) return;
            document.getElementById('room-title').innerText = currentRoom;
            document.getElementById('messages').innerHTML = ""; 
            socket.emit('join-room', currentRoom);
            showPage('chat');
        }

        function sendMsg() {
            const input = document.getElementById('msg-input');
            if(!input.value) return;
            socket.emit('chat-message', { roomId: currentRoom, name: myName, text: input.value });
            input.value = "";
        }

        socket.on('chat-message', (data) => {
            const div = document.createElement('div');
            const isMe = data.name === myName;
            div.className = isMe ? 'msg-bubble my-msg' : 'msg-bubble other-msg';
            div.innerHTML = (isMe ? "" : `<div class="user-name">${data.name}</div>`) + data.text;
            const msgBox = document.getElementById('messages');
            msgBox.appendChild(div);
            msgBox.scrollTop = msgBox.scrollHeight;
        });
    </script>
</body>
</html>