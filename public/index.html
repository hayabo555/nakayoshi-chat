<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Naka-Chat Pro</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>

    <div id="page-login" class="page active">
        <div class="login-box">
            <div class="logo"><i class="fa-solid fa-comments"></i></div>
            <h2>ãŠã‹ãˆã‚Šãªã•ã„ï¼</h2>
            <p>å‹é”ãŒå¾…ã£ã¦ã„ã¾ã™</p>
            <input type="text" id="username" placeholder="åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
            <button onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </div>
    </div>

    <div id="page-home" class="page">
        <header>ãƒ›ãƒ¼ãƒ </header>
        <div class="content">
            <div class="my-profile">
                <div class="avatar"><i class="fa-solid fa-circle-user"></i></div>
                <div class="name-area"><span id="my-name-display"></span> <small>(Online)</small></div>
            </div>
            <div class="section-title">ãƒ•ãƒ¬ãƒ³ãƒ‰ (0)</div>
            <p class="empty-msg">ã¾ã ãƒ•ãƒ¬ãƒ³ãƒ‰ãŒã„ã¾ã›ã‚“ã€‚ãŠã·ã¡ã‚ƒã§æ¢ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</p>
        </div>
        <nav class="bottom-nav"></nav>
    </div>

    <div id="page-rooms" class="page">
        <header>ã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆ</header>
        <div class="content">
            <div class="search-bar">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" id="target-room" placeholder="éƒ¨å±‹åã‚’å…¥åŠ›...">
                <button onclick="joinRoom()">å‚åŠ </button>
            </div>
            <div class="room-list">
                <div onclick="joinRoom('é›‘è«‡éƒ¨å±‹')" class="room-card">
                    <div class="room-icon">ğŸŒ¸</div>
                    <div class="room-info"><b>é›‘è«‡éƒ¨å±‹</b><br><small>èª°ã§ã‚‚æ­“è¿ï¼æ¥½ã—ãè©±ãã†</small></div>
                </div>
                <div onclick="joinRoom('ã‚²ãƒ¼ãƒ éƒ¨å±‹')" class="room-card">
                    <div class="room-icon">ğŸ®</div>
                    <div class="room-info"><b>ã‚²ãƒ¼ãƒ éƒ¨å±‹</b><br><small>æœ€æ–°ã‚²ãƒ¼ãƒ ã®è©±é¡Œã¯ã“ã¡ã‚‰</small></div>
                </div>
            </div>
        </div>
        <nav class="bottom-nav"></nav>
    </div>

    <div id="page-chat" class="page">
        <header class="chat-header">
            <button onclick="showPage('rooms')" class="back-btn"><i class="fa-solid fa-chevron-left"></i></button>
            <span id="room-title">éƒ¨å±‹å</span>
            <i class="fa-solid fa-bars"></i>
        </header>
        <div id="messages"></div>
        <div class="input-area">
            <i class="fa-solid fa-plus"></i>
            <input type="text" id="msg-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...">
            <button onclick="sendMsg()"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

    <script>
        const socket = io();
        let myName = "";
        let currentRoom = "";

        // ä¸‹éƒ¨ãƒŠãƒ“ã‚’ç”Ÿæˆ
        const navHtml = `
            <button onclick="showPage('home')"><i class="fa-solid fa-user"></i><span>ãƒ›ãƒ¼ãƒ </span></button>
            <button onclick="showPage('rooms')"><i class="fa-solid fa-comment"></i><span>ãƒãƒ£ãƒƒãƒˆ</span></button>
            <button onclick="openYoutube()"><i class="fa-brands fa-youtube" style="color:red"></i><span>YouTube</span></button>
        `;
        document.querySelectorAll('.bottom-nav').forEach(nav => nav.innerHTML = navHtml);

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
        }

        function login() {
            myName = document.getElementById('username').value;
            if(!myName) return;
            document.getElementById('my-name-display').innerText = myName;
            showPage('home');
        }

        function openYoutube() { window.location.href = "https://choco-tube-nana-01.onrender.com"; }

        function joinRoom(name) {
            currentRoom = name || document.getElementById('target-room').value;
            if(!currentRoom) return;
            document.getElementById('room-title').innerText = currentRoom;
            document.getElementById('messages').innerHTML = ""; 
            socket.emit('join-room', currentRoom);
            showPage('chat');
        }

        function sendMsg() {
            const input = document.getElementById('msg-input');
            if(!input.value.trim()) return;
            socket.emit('chat-message', { roomId: currentRoom, name: myName, text: input.value });
            input.value = "";
        }

        socket.on('chat-message', (data) => {
            const msgBox = document.getElementById('messages');
            const isMe = data.name === myName;
            const div = document.createElement('div');
            div.className = isMe ? 'msg-bubble my-msg' : 'msg-bubble other-msg';
            div.innerHTML = (isMe ? "" : `<div class="user-name">${data.name}</div>`) + `<div class="text">${data.text}</div>`;
            msgBox.appendChild(div);
            msgBox.scrollTo({ top: msgBox.scrollHeight, behavior: 'smooth' });
        });
    </script>
</body>
</html>