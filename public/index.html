<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ä»²è‰¯ã—CHAT Pro</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>

    <div id="login-screen" class="login-screen">
        <div class="login-card">
            <i class="fa-solid fa-heart" style="font-size: 40px; color: var(--accent);"></i>
            <h2 style="color: #555;">ä»²è‰¯ã—CHAT</h2>
            <input type="text" id="username" placeholder="åå‰ã‚’å…¥åŠ›..." maxlength="10">
            <button onclick="login()" style="width: 100%; padding: 15px; background: var(--accent); color: white; border: none; border-radius: 15px; font-weight: bold;">ã¯ã˜ã‚ã‚‹</button>
        </div>
    </div>

    <header>
        <div style="font-weight: 800; color: #555; font-size: 1.2rem;">ğŸŒ¸ Naka-Chat</div>
        <div class="online-badge"><i class="fa-solid fa-users"></i> <span id="online-count">0</span></div>
    </header>

    <div id="messages"></div>

    <div class="input-area">
        <input type="text" id="msg-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸..." autocomplete="off">
        <button class="send-btn" onclick="sendMsg()"><i class="fa-solid fa-paper-plane"></i></button>
    </div>

    <footer>
        <button class="active"><i class="fa-solid fa-comment-dots"></i>ãƒãƒ£ãƒƒãƒˆ</button>
        <button onclick="window.location.href='https://choco-tube-nana-01.onrender.com'"><i class="fa-brands fa-youtube" style="color:#ff0000"></i>YouTube</button>
    </footer>

    <script>
        const socket = io();
        let myName = "";
        const sound = new Audio('https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3');

        function login() {
            const user = document.getElementById('username').value.trim();
            if(!user) return alert("åå‰ã‚’æ•™ãˆã¦ã­ï¼");
            myName = user;
            document.getElementById('login-screen').style.display = 'none';
        }

        function sendMsg() {
            const input = document.getElementById('msg-input');
            if(!input.value.trim()) return;
            socket.emit('chat-message', { name: myName, text: input.value });
            input.value = "";
        }

        function addMessage(data) {
            const box = document.getElementById('messages');
            const isMe = data.name === myName;
            const div = document.createElement('div');
            div.className = `msg-bubble ${isMe ? 'my-msg' : 'other-msg'}`;
            div.innerHTML = `
                ${isMe ? '' : '<div class="user-name">' + data.name + '</div>'}
                <div>${data.text}</div>
                <div class="msg-time">${data.time}</div>
            `;
            box.appendChild(div);
            box.scrollTo({ top: box.scrollHeight, behavior: 'smooth' });
        }

        socket.on('load-history', (history) => history.forEach(addMessage));
        socket.on('chat-message', (data) => {
            addMessage(data);
            if(data.name !== myName) sound.play().catch(()=>{});
        });
        socket.on('update-online-count', (count) => document.getElementById('online-count').innerText = count);

        document.getElementById('msg-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') sendMsg(); });
    </script>
</body>
</html>